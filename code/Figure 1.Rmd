---
title: "Figure 1 script"
author: 'By: Claire Gonzales'
date: "6/9/2022"
output: 
  html_document: 
    theme: lumen
    code_folding: hide
---

### Description

**OBJECTIVE**: Figure 1 is going to be two panes. The first pane (Fig. 1a) will have total publications published over time. The second pane (Fig. 1b) will have three lines (ecology, governance, and socioeconomics) and will show the frequency of these types of publications over time. All three categories in pane 2 (Fig. 1b) will not add up to the total publications in pane 1 (Fig. 1a).

**REFLECTIONS**: I'm trying to figure out if these visualizations are useful and informative. I think the story that they tell is that socioeconomics tends to be the leading discipline in current co-location literature. It makes sense for governance to be lower because policy pathways aren't yet established for co-location in most regions so there's isn't much to study in that discipline. However, ecology should be higher. In fact, we saw a widespread lack of ecological metrics, even in those publications that clearly were referring to the ecology of co-location. Call to action: future research should fill this gap. Not only do we need to collect baseline metrics when publishing co-location studies, but we also need to begin measuring environmental impacts from co-location activities, which has largely not been addressed.


```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
library(tidyverse)
library(here)
library(lubridate)
library(plotly)
library(paletteer)
library(cowplot)
library(broom)

```

### Reading in Data

Data contains 'orphans'. 

```{r}
mydata <- read_csv(here("data", "Data_total_working_for_r.csv"))
  
```

### Pane 1 Wrangling
Subset to only look at year and types of co-location. 

```{r}
data_sub <- mydata %>% 
  select(first_author, year, ecology, governance, socioecon, horizon_scan, industry, impact, model, `pilot/testing`, emp) %>% 
  group_by(year) %>% 
  summarize(count = n())

```

### Pane 1 Viz
```{r}
# Pane 1 (Fig. 1a)
# count of publications over time

g1 <- ggplot(data = data_sub, aes(x = year, y = count)) +
  geom_line(size = .7) +
  labs(x = "Year",
       y = "Count") +
  ylim(0,15) +
  theme_classic() 
 # geom_smooth(method = "lm")

# +
#   theme(axis.text.x = element_text(angle = 45))

ggplotly(g1)
```

```{r, include=FALSE, eval=FALSE}
# regression of g1

g1_lm <- lm(data_sub$count ~ data_sub$year)

summary(g1_lm)

tidy(g1_lm)

## slope here is 0.8622 with an r^2 value of 0.7631
# "If everything else stays constant, on average we would expect an increase of .8622 co-location publications per year" and 76.31% of the variants are explained by this model

```


```{r, eval=FALSE, include=FALSE}

# This is to look at regression of only the years 2013 and 2015

ggplotly(
  ggplot(data = data_sub, aes(x = year, y = count)) +
  geom_line(size = .7) +
  labs(x = "Year",
       y = "Count") +
  xlim(2013, 2017) +
  theme_classic() +
  geom_smooth(method = "lm")
)
```

```{r, include=FALSE, eval=FALSE}
# regression of g1 ONLY the time period of substantial growth (2013-2017)

data_sub_filt <- data_sub %>% 
  filter(year %in% 2013:2017)

g1_sub_lm <- lm(data_sub_filt$count ~ data_sub_filt$year)

summary(g1_sub_lm)

## slope here is 2.8 with an r^2 value of 0.9333
# "If everything else stays constant, on average we would expect an increase of 2.8 co-location publications per year" and 93% of the variants are explained by this model

```


### Pane 2 Wrangling

This might be semi sloppy code and there might be a cleaner way to do this but I'm not sure what that would be and I feel confident in the messy coding I've done here. 


```{r, eval=FALSE, include=FALSE}
# now same for total section
# I added this chunk much later (7/15) to try and visualize total line on same axis with category lines

total <- rep(c("Total"), times = 14)

total_sub <- cbind(data_sub$year,
                   total,
                   data_sub$count
                    )

total_b_df <- data.frame(total_sub) %>% 
  rename(year = V1) %>% 
  rename(discipline = total) %>% 
  rename(count = V3)

```


```{r}
# Need to rearrange the data for pane 2
# Plan to create a subset that filters for all the ecology counts and totals them over time
  # then do the same thing for governance and socioecon
  # then rbind them together

data_sub_b_ecol <- mydata %>% 
  select(first_author, year, ecology) %>% 
  group_by(year) %>% 
  summarize(count = sum(ecology))

ecology <- rep(c("Ecology"), times = 14)

#colnames <- c("year", "discipline", "count")

ecol_sub <- cbind(data_sub_b_ecol$year,
              ecology,
              data_sub_b_ecol$count)

ecol_df <- data.frame(ecol_sub) %>% 
  rename(year = V1) %>% 
  rename(discipline = ecology) %>% 
  rename(count_di = V3)
```

```{r}
# same thing for socioeconomics section
data_sub_b_socio <- mydata %>% 
  select(first_author, year, socioecon) %>% 
  group_by(year) %>% 
  summarize(count = sum(socioecon))

socioecon <- rep(c("Socioeconomics"), times = 14)


socio_sub <- cbind(data_sub_b_socio$year,
              socioecon,
              data_sub_b_socio$count)

socio_df <- data.frame(socio_sub) %>% 
  rename(year = V1) %>% 
  rename(discipline = socioecon) %>% 
  rename(count_di = V3)

```

```{r}
# same thing for governance section
data_sub_b_gov <- mydata %>% 
  select(first_author, year, governance) %>% 
  group_by(year) %>% 
  summarize(count = sum(governance))

governance <- rep(c("Governance"), times = 14)


gov_sub <- cbind(data_sub_b_gov$year,
              governance,
              data_sub_b_gov$count)

gov_df <- data.frame(gov_sub) %>% 
  rename(year = V1) %>% 
  rename(discipline = governance) %>% 
  rename(count_di = V3)
```

```{r}
# 28 April 2023
### Adding the motivations ###
# running the above code now for HS, industry, and impact

data_sub_b_hs <- mydata %>% 
  select(first_author, year, horizon_scan) %>% 
  group_by(year) %>% 
  summarize(count = sum(horizon_scan))

horizon_scanning <- rep(c("Horizon Scanning"), times = 14)


hs_sub <- cbind(data_sub_b_hs$year,
              horizon_scanning,
              data_sub_b_hs$count)

hs_df <- data.frame(hs_sub) %>% 
  rename(year = V1) %>% 
  rename(motive = horizon_scanning) %>% 
  rename(count_mo = V3)


```

```{r}
# for industry_dev motive

data_sub_b_industry <- mydata %>% 
  select(first_author, year, industry) %>% 
  group_by(year) %>% 
  summarize(count = sum(industry))

industry_dev <- rep(c("Industry Development"), times = 14)


industry_sub <- cbind(data_sub_b_industry$year,
              industry_dev,
              data_sub_b_industry$count)

industry_df <- data.frame(industry_sub) %>% 
  rename(year = V1) %>% 
  rename(motive = industry_dev) %>% 
  rename(count_mo = V3)

```


```{r}
#for impact motive
data_sub_b_impact <- mydata %>% 
  select(first_author, year, impact) %>% 
  group_by(year) %>% 
  summarize(count = sum(impact))

impact_risk <- rep(c("Impact/Risk"), times = 14)


impact_sub <- cbind(data_sub_b_impact$year,
              impact_risk,
              data_sub_b_impact$count)

impact_df <- data.frame(impact_sub) %>% 
  rename(year = V1) %>% 
  rename(motive = impact_risk) %>% 
  rename(count_mo = V3)
```

```{r}
total <- rep(c("Total"), times = 14)

total_sub <- cbind(data_sub$year,
                   total,
                   data_sub$count
                    )

total_b_df <- data.frame(total_sub) %>% 
  rename(year = V1) %>% 
  rename(motive = total) %>% 
  rename(count_mo = V3)
```


```{r}
# rbinding the 3 dfs into one

discipline_df <- rbind(#total_b_df, 
                ecol_df, gov_df, socio_df) %>% 
  mutate(year = as.numeric(year)) %>% 
  mutate(count_di = as.integer(count_di))

# class was checked and its a data frame

# all_df$discipline <- factor(all_df$discipline,
#                             levels = c("Total",
#                                        "Ecology",
#                                        "Governance",
#                                        "Socioeconomics"))

motives_df <- rbind(#total_b_df, 
                    hs_df, industry_df, impact_df) %>% 
  mutate(year = as.numeric(year)) %>% 
  mutate(count_mo = as.integer(count_mo))

all_df <- merge(discipline_df, motives_df, by = "year")

```

### Pane 2 Viz

Using ggplotly() here to allow us to look at each value, when needed. 

```{r}
### pane two option for disciplines ####

g2_dis <- ggplot(data = discipline_df, aes(x = year, y = count_di)) +
  geom_line(aes(linetype = discipline), color = "darkgray",
            size = .7) +
  labs(x = "Year",
       y = "Count") +
  scale_y_continuous(limits = c(0,13), breaks = seq(0,13, by = 5)) +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5), legend.title = element_blank(), legend.position= 'top', legend.text=element_text(size=8)) +
  #geom_line(data = data_sub, aes(x = year, y = count)) +
  ylim(0,15)

ggplotly(g2_dis)
```

```{r}
# pane two option for MOTIVES
g2_mo <- ggplot(data = motives_df, aes(x = year, y = count_mo)) +
  geom_line(aes(linetype = motive), color = "darkgray", 
            size = .7) +
  labs(x = "Year",
       y = "Count") +
  scale_y_continuous(limits = c(0,13), breaks = seq(0,13, by = 5)) +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5), legend.title = element_blank(), legend.position= 'top', legend.text=element_text(size=7)) +
  geom_line(data = data_sub, aes(x = year, y = count)) +
  ylim(0,15)

ggplotly(g2_mo)
```

```{r}
# second option for pane 2 with MOTIVES

g3_mo <- ggplot(data = motives_df, aes(x = year, y = count_mo)) +
  geom_bar(position="stack", stat="identity", aes(fill = motive)) +
  labs(x = "Year",
       y = "Count") +
  #scale_y_continuous(limits = c(0,13), breaks = seq(0,13, by = 5)) +
  theme_classic() +
  scale_fill_paletteer_d(palette = "ggprism::black_and_white") +
  theme(plot.title = element_text(hjust = 0.5), legend.title = element_blank(), legend.position= 'top', legend.text=element_text(size=8)) +
  ylim(0,15)

ggplotly(g3_mo)
```

```{r}
# second option for pane 2 with MOTIVES

g3_dis <- ggplot(data = discipline_df, aes(x = year, y = count_di)) +
  geom_bar(position="stack", stat="identity", aes(fill = discipline)) +
  labs(x = "Year",
       y = "Count") +
  scale_y_continuous(limits = c(0,15), breaks = seq(0,15, by = 5)) +
  theme_classic() +
  scale_fill_paletteer_d(palette = "ggprism::black_and_white") +
  theme(plot.title = element_text(hjust = 0.5),legend.title = element_blank(), legend.position= 'top', legend.text=element_text(size=8))

ggplotly(g3_dis)
```


### Patching panes together

Using cowplot package and `plot_grid()` to patch panes 1 and 2 together
## pick up here - not working
```{r}
######### NOT WORKING BOOOOO ###########
dis_mo <- plot_grid(g2_dis, g3_mo, nrow = 2, labels = c("B", "C"), align = "v")

plot_grid(g1, dis_mo, nrow = 1, align = "h", labels = c("A", " "))

ggsave(filename = here("figures", "fig1_new_v1.jpeg"), width = 10, height = 6, units = "in")


```

**Figure 1.** Shows frequency of publications over time (years 2000-2022). **Pane A** reflects the total frequency of co-location publications published over time. **Pane B** reflects the frequency of co-location publications, separated by publication discipline (ie ecology, governance or socioeconomics), published over time.  
