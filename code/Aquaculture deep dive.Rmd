---
title: "Aquaculture Deep Dive"
author: 'By: Claire Gonzales'
date: '2022-08-16'
output: 
  html_document: 
    theme: lumen
    toc: yes
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
library(tidyverse)
library(tidyselect)
library(here)
library(ggbeeswarm)
library(dplyr)
library(cowplot)
library(broom)

```

## Initial data exploration
Hidden
```{r, eval=FALSE, include=FALSE}
mydata <- read_csv(here("data", "Data_total_working_for_r.csv"))
  
```

```{r, eval=FALSE, include=FALSE}
aquaculture <- mydata %>% 
  select(id, year, aquaculture_present, ecology, governance, socioecon) %>% 
  filter(aquaculture_present == "1")

aqua_mini <- aquaculture %>% 
  group_by(aquaculture_present) %>% 
  summarize(
    eco = sum(ecology),
    gov = sum(governance),
    socio = sum(socioecon)
  )
  
```

```{r, eval=FALSE, include=FALSE}
wind <- mydata %>% 
  select(id, year, wind_present, ecology, governance, socioecon) %>% 
  filter(wind_present == "1")

wind_mini <- wind %>% 
  group_by(wind_present) %>% 
  summarize(
    eco = sum(ecology),
    gov = sum(governance),
    socio = sum(socioecon)
  )
```

```{r, eval=FALSE, include=FALSE}
max_depth_m <- as.numeric(c(25, 16, 33.4, 40, 200, 500, 70, 40, 300, 60, 40, 200, 300, 200))

median(max_depth_m)

```

```{r, eval=FALSE, include=FALSE}
distance_km <- as.numeric(c(15, 16, 55, 10, 30, 8, 1.2, 1.9, 37, 60, 22, 16, 32, 25))

median(distance_km)
```

```{r, eval=FALSE, include=FALSE}
sigwaveheight_m <- as.numeric(c(1.5, 1.25, 2.1, 2, 2, 1.8, 5))

median(sigwaveheight_m)
```

## Metrics across top three sectors 

### Aquaculture metric wrangling

Looking into aquaculture metrics
```{r}
aqdata <- read.csv(here("data", "Data_total_working_for_r_aq.csv"))
```

```{r}
aqdata_sub <- aqdata %>% 
  filter(metric == "Aquaculture") %>% 
  select("metric", "id", "title", "distance_to_shore", "depth_min", "depth_max", "depth_ave", "wave_height_average_m", "sst_c", "chla") 
  
aqdata_sub_2 <- aqdata %>% 
  filter(metric == "Aquaculture") %>% 
  select("metric", "id", "title", "distance_to_shore", "depth_min", "depth_max", "depth_ave", "wave_height_average_m", "sst_c", "chla", "wind_present", "wave_present", "tidal_present", "other_present") 
  
  
  # summarize(dist_median = median(distance_to_shore, na.rm = TRUE),
  #           depth_max_median = median(depth_max, na.rm = TRUE),
  #           sigwave_median = median(wave_height_average_m, na.rm = TRUE),
  #           sst_median = median(sst_c, na.rm = TRUE),
  #           chla_median = median(chla, na.rm = TRUE))
```

### Wind metric wrangling

Looking at wind metrics only
```{r}
winddata <- read.csv(here("data", "Data_total_working_for_r_wind.csv"))
```

```{r}
winddata_sub <- winddata %>% 
  filter(metric == "Wind") %>% 
  select("metric", "id", "title", "distance_to_shore", "depth_min", "depth_max", "depth_ave", "wave_height_average_m", "sst_c", "chla") 


  # group_by(metric) %>% 
  # summarize(dist_median = median(distance_to_shore, na.rm = TRUE),
  #           depth_max_median = median(depth_max, na.rm = TRUE),
  #           sigwave_median = median(wave_height_average_m, na.rm = TRUE),
  #           sst_median = median(sst_c, na.rm = TRUE),
  #           chla_median = median(chla, na.rm = TRUE))
```

### Wave metric wrangling

Only looking at wave metrics

```{r}
wavedata <- read.csv(here("data", "Data_total_working_for_r_wave.csv"))
```

```{r}
wavedata_sub <- wavedata %>% 
  filter(metric == "Wave") %>% 
  select("metric", "id", "title", "distance_to_shore", "depth_min", "depth_max", "depth_ave", "wave_height_average_m", "sst_c", "chla")
```

### Rbinding metrics from 3 sectors together

Creating 'datadata', which has all the metrics and is labeled by Aquaculture, Wind or Wave. DANGER: This data by nature has duplicates because some metrics in wave are also in wind, etc. **ONLY USE for graphing or to compare across sectors. Any examination of the data as a whole will be misleading.**

```{r}
datadata <- rbind(aqdata_sub, winddata_sub, wavedata_sub)
```


### Fig 4a code

Comparing listed depths across discipline (AQ, wave, and wind)
```{r}
fig4a <- ggplot(data = datadata, aes(x = metric, y = depth_ave)) +
  geom_beeswarm(size = 2, cex = 3, color = "darkgray") +
  #scale_color_manual(values = c("goldenrod2","cyan4","coral")) +
  geom_boxplot(fill = NA, width = 0.3, outlier.color = NA) +
  stat_summary(fun=median, 
               geom="point", 
               shape=20, 
               size=3, 
               color="black", 
               fill="black") +
  #geom_line(xintercept = 11:100)
  # geom_segment(aes(x = "Aquaculture", y = 11, xend = "Aquaculture", yend = 100), position = 0.5, color = "red") +
  # geom_segment(aes(x = "Wave", y = 3, xend = "Wave", yend = 600, hjust = 0.35), color = "red") +
  # geom_segment(aes(x = "Wind", y = 0, xend = "Wind", yend = 200, hjust = 0.35), color = "red") +
    labs(x = "Ocean activity",
         y = "Average depth (m)") +
  theme_minimal() +
  theme(legend.title = element_blank()) +
  scale_y_reverse()

########### lines for in situ ranges here added using power point ###########

```

```{r, include = FALSE, eval = FALSE}
# old code for figure 4(a and kinda b) that used color coding. Redoing with shape coding

# ggplot(data = datadata, aes(x = metric, y = depth_ave)) +
#   geom_beeswarm(aes(color = metric), size = 2, cex = 3) +
#   scale_color_manual(values = c("goldenrod2","cyan4","coral")) +
#   geom_boxplot(fill = NA, width = 0.3, outlier.color = NA) +
#   stat_summary(fun=median, 
#                geom="point", 
#                shape=20, 
#                size=3, 
#                color="black", 
#                fill="black") +
#     labs(x = "Ocean Activity",
#          y = "Average Depth (m)") +
#   theme_minimal() +
#   theme(legend.title = element_blank()) +
#   scale_y_reverse()
```

**Figure 4a.** Shows the average depth (meters) across the three most common ocean activities listed in co-location literature. Metrics within aquaculture (n = 14), wave energy (n = 22), and wind energy (n = 35) sectors all reflect similar distances from shore. Significance across these three data groups was checked using a Kruskal-Wallis test (p = 0.4673). 


### Fig 5a code

Comparing distances to shore across discipline (AQ, wave, and wind)
```{r}
fig5a <- ggplot(data = datadata, aes(x = metric, y = distance_to_shore)) +
  geom_beeswarm(color = "darkgray", size = 2, cex = 3) +
  geom_boxplot(fill = NA, width = 0.3, outlier.color = NA) +
  stat_summary(fun=median, 
               geom="point", 
               shape=20, 
               size=3, 
               color="black", 
               fill="black") +
  labs(x = "Ocean activity",
       y = "Distance from shore (km)") +
  theme_minimal() +
  theme(legend.title = element_blank(), legend.position = "none")

```

**Figure 4b.** Shows the distances from shore (meters) across the three most common ocean activities listed in co-location literature. Metrics within aquaculture (n = 14), wave energy (n = 19), and wind energy (n = 32) sectors all reflect similar distances from shore. Significance across these three data groups was checked using a Kruskal-Wallis test (p = 0.3366).


## Other metric comparisons (low n values)

Comparing minimum listed depths across discipline
```{r, include=FALSE, eval=FALSE}
ggplot(data = datadata, aes(x = metric, y = depth_min)) +
  geom_beeswarm(aes(color = metric)) +
  scale_color_manual(values = c("goldenrod2","cyan4","coral")) +
  geom_boxplot(fill = NA, width = 0.3, outlier.color = NA) +
  stat_summary(fun=median, 
               geom="point", 
               shape=20, 
               size=3, 
               color="black", 
               fill="black") +
  theme_minimal()
```

Comparing maximum listed significant wave heights across discipline
```{r}
ggplot(data = datadata, aes(x = metric, y = wave_height_average_m)) +
  geom_beeswarm(aes(color = metric)) +
  scale_color_manual(values = c("goldenrod2","cyan4","coral")) +
  geom_boxplot(fill = NA, width = 0.3, outlier.color = NA) +
  stat_summary(fun=median, 
               geom="point", 
               shape=20, 
               size=3, 
               color="black", 
               fill="black") +
  theme_minimal()
```

Comparing SSTs (degrees celcius) across disciplines
```{r}
ggplot(data = datadata, aes(x = metric, y = sst_c)) +
  geom_beeswarm(aes(color = metric)) +
  scale_color_manual(values = c("goldenrod2","cyan4","coral")) +
  geom_boxplot(fill = NA, width = 0.3, outlier.color = NA) +
  stat_summary(fun=median, 
               geom="point", 
               shape=20, 
               size=3, 
               color="black", 
               fill="black") +
  theme_minimal()
```

## Examining aquaculture metrics ONLY
Using 'aqdata_sub_2' from above to examine aquacutlure metrics more closely.


### What is aquaculture being co-located with?
Creating a dataset called 'alltogether' that shows aquaculture metrics, grouped by the activity it is being co-located with (aka the "buddy")

```{r}
aqua_wind <- aqdata_sub_2 %>% 
  filter(wind_present == "1") %>% 
  mutate(buddy = rep("Wind", 19))
```

```{r}
aqua_wave <- aqdata_sub_2 %>% 
  filter(wave_present == "1") %>% 
  mutate(buddy = rep("Wave", 8))

```

```{r}
aqua_tidal <- aqdata_sub_2 %>% 
  filter(tidal_present == "1") %>% 
  mutate(buddy = rep("Tidal", 3))


```

```{r}
aqua_other <- aqdata_sub_2 %>% 
  filter(other_present == "1") %>% 
  mutate(buddy = rep("Other", 8))


```

```{r}
alltogether <- as_tibble(rbind(aqua_wind, aqua_wave, aqua_tidal, aqua_other))

alltogether$buddy <- factor(alltogether$buddy,
                            levels = c("Wind", 
                                       "Wave", 
                                       "Tidal", 
                                       "Other"))
```


Graphing the depth differences of aquaculture at different depths. 
**DANGER: this data set is misleading because of duplicates/overlapping values across buddies that here are being depicted as different values**

```{r, eval=FALSE, include=FALSE}
ggplot(data = alltogether, aes(x = metric, y = depth_ave)) +
  geom_jitter(aes(color = buddy), width = 0.25) +
  scale_color_manual(values = c("goldenrod2","cyan4","coral", "darkviolet")) +
  geom_boxplot(fill = NA, width = 0.3, outlier.color = NA) +
  stat_summary(fun=median,
               geom="point",
               shape=20,
               size=4,
               color="black",
               fill="black") +
  theme_minimal() +
  scale_y_reverse()

# I like this figure but I think it's too misleading so I shouldn't use
```

Graphing the depth differences of aquaculture at different "buddies"
```{r}

# original code with color coding. Potential code for shape coding in next code chunk

ggplot(data = alltogether, aes(x = buddy, y = depth_ave)) +
  geom_beeswarm(aes(color = buddy), cex = 2) +
  scale_color_manual(values = c("goldenrod2","cyan4","coral", "darkviolet")) +
  geom_boxplot(fill = NA, width = 0.3, outlier.color = NA) +
  stat_summary(fun=median,
               geom="point",
               shape=20,
               size=3,
               color="black",
               fill="black") +
  labs(x = "Co-locating activity",
       y = "Average depth (m)") +
  theme_minimal() +
  theme(legend.title = element_blank()) +
  scale_y_reverse()

```

```{r, include=FALSE, eval=FALSE}

# ggplot(data = alltogether, aes(x = buddy, y = depth_ave)) +
#   geom_beeswarm(aes(shape = buddy), cex = 2, size = 2) +
#   geom_boxplot(fill = NA, width = 0.4, outlier.color = NA) +
#   stat_summary(fun=median,
#                geom="line",
#                color="black",
#                fill="black") +
#   labs(x = "Co-locating activity",
#        y = "Average depth (m)") +
#   theme_minimal() +
#   scale_y_reverse()
```


Graphing the depth differences of aquaculture at different distances from shore 
**DANGER: same misleading data issue as above**
```{r}
ggplot(data = alltogether, aes(x = metric, y = distance_to_shore)) +
  geom_jitter(aes(color = buddy), width = 0.25) +
  scale_color_manual(values = c("goldenrod2","cyan4","coral", "darkviolet")) +
  geom_boxplot(fill = NA, width = 0.3, outlier.color = NA) +
  stat_summary(fun=median, 
               geom="point", 
               shape=20, 
               size=4, 
               color="black", 
               fill="black") +
  theme_minimal()
```

Graphing the differences in distance to shore of aquaculture across different "buddies"
```{r}
ggplot(data = alltogether, aes(x = buddy, y = distance_to_shore)) +
  geom_beeswarm(aes(color = buddy), cex = 2) +
  scale_color_manual(values = c("goldenrod2","cyan4","coral", "darkviolet")) +
  geom_boxplot(fill = NA, width = 0.3, outlier.color = NA) +
  stat_summary(fun=median, 
               geom="point", 
               shape=20, 
               size=3, 
               color="black", 
               fill="black") +
  theme_minimal()
```


## Plan for Fig 4&5
Here, I am trying something new. Instead of having the Fig 4 panes of ave depth and distance from shore for aqua, wave and wind and THEN having a fig 5 of panes with the buddy of aqua dataset, This section will try having:

fig 4a: Ave Depth of aqua, wave and wind
fig 4b: co-location "buddies" of aqua depth metrics
fig 5a: Distance from shore of aqua, wave and wind
fig 5b: co-location "buddies" of aqua distance from shore metrics

### Fig 4b code
```{r}

fig4b <- ggplot(data = alltogether, aes(x = buddy, y = depth_ave)) +
  geom_beeswarm(cex = 3, size = 2) +
 # scale_color_manual(values = c("goldenrod2","cyan4","coral", "darkviolet")) +
  # geom_boxplot(
  #   #data = aqdata_sub_2, 
  #   fill = NA, width = 0.3, outlier.color = NA) +
  # stat_summary(fun=median,
  #              geom="point",
  #              shape=20,
  #              size=3,
  #              color="black",
  #              fill="black") +
  labs(x = "Aquaculture co-located activity",
       y = "Average depth (m)") +
  theme_minimal() +
  theme(
    #axis.text.x = element_text(angle=60), 
        legend.title = element_blank()) +
  scale_y_reverse()

```


### Fig 5b code
```{r}

fig5b <- ggplot(data = alltogether, aes(x = buddy, y = distance_to_shore)) +
  geom_beeswarm(cex = 3, size = 2) +
  scale_color_manual(values = c("goldenrod2","cyan4","coral", "darkviolet")) +
  labs(x = "Aquaculture co-located activity",
       y = "Distance from shore (km)") +
  theme_minimal() +
  theme(legend.title = element_blank())

```

### Patching fig 4 together

```{r}
#legend <- get_legend(fig4a)

plot_grid(
  fig4a + theme(legend.position = "none"), 
  fig4b + theme(legend.position = "none"), 
  align = "vh", 
  labels = c("A", "B"))

```

```{r, include = FALSE, eval = FALSE}

#Old code that creates a pane for the original figure 4, with a shared legend on the right side.
# rel_widths command helped with the spacing, so it made the legend its own pane, 
# but that pane was much narrower.

# legend <- get_legend(fig4a)
# 
# prow <- plot_grid(
#   fig4a + theme(legend.position = "none"), 
#   fig4b + theme(legend.position = "none"), 
#   align = "vh", 
#   labels = c("A", "B")) 
#           
# plot_grid(prow, legend, rel_widths = c(2, .4))   
```


**Figure 4.** Shows (A) the average depth (meters) across aquaculture (n = 14), wave energy (n = 22), and wind energy (n = 35) sectors. These three ocean activities all reflect similar average reported depths (Kruskal-Wallis p = 0.467)...


### writing jpeg for fig4

```{r, include=FALSE, eval=FALSE}
ggsave(filename = here("figures", "fig4_new2.jpeg"), width = 8, height = 5, units = "in")
```


### Patching fig 5 together

```{r}
#legend <- get_legend(fig4a)

plot_grid(
  fig5a + theme(legend.position = "none"), 
  fig5b + theme(legend.position = "none"), 
  align = "vh", 
  labels = c("A", "B"))

```

**Figure 5.** Pane (A) shows the distance from shore (meters) across aquaculture (n = 14), wave energy (n = 19), and wind energy (n = 32). These sectors all reflect similar distances from shore (Kruskal-Wallis p = 0.337). Pane (B) …

### writing jpeg for fig5

```{r, include=FALSE, eval=FALSE}
ggsave(filename = here("figures", "fig5_new2.jpeg"), width = 8, height = 5, units = "in")
```



### Kruskal-Wallis of aquaculture metrics

Comparing aquaculture metrics against wind and wave
```{r}
datadata_anova <- aov(depth_ave ~ metric, data = datadata)

summary(datadata_anova)

# depth_ave: p-value = 0.551
# distance to shore: p-value = 0.394

```

Making the same comparison using a Kruskal-Wallis test.
```{r}
datadata_kruswall <- kruskal.test(distance_to_shore ~ metric, data = datadata)

datadata_kruswall

# depth_ave: p-value = p-value = 0.387
# distance to shore: p-value = 0.5923
```
Kruskal Wallis test is the better test for this data because we violate the assumtions of the ANOVA, but a Kruskal Wallis test does not require these assumptions. Kruskal Wallis is non-parametric and ranks-based assessment of medians. 

```{r}
alltogether_kruswall_depth <- kruskal.test(depth_ave ~ buddy, data = alltogether)

alltogether_kruswall_depth
# Kruskal-Wallis chi-squared = 0.70418, df = 3, p-value = 0.8722

alltogether_kruswall_dist <- kruskal.test(distance_to_shore ~ buddy, data = alltogether)

alltogether_kruswall_dist
# Kruskal-Wallis chi-squared = 0.12126, df = 3, p-value = 0.9892

```


### Sample sizes
Determining the n values of distance from shore and average depth for each ocean activity in datadata

summary_datadata has the median values
nvals_datadata has the n values
```{r}
summary_datadata <- datadata %>% 
  group_by(metric) %>% 
  summarize(median_depth = median(depth_ave, na.rm = TRUE),
            sd_depth = sd(depth_ave, na.rm = TRUE),
            q3_depth = quantile(depth_ave, na.rm = TRUE, c(0.75)),
            q1_depth = quantile(depth_ave, na.rm = TRUE, c(0.25)),
            median_dist = median(distance_to_shore, na.rm = TRUE),
            sd_dist = sd(distance_to_shore, na.rm = TRUE),
            q3_dist = quantile(distance_to_shore, na.rm = TRUE, c(0.75)),
            q1_dist = quantile(distance_to_shore, na.rm = TRUE, c(0.25)),)


nvals_datadata_depth <- datadata %>% 
  filter(depth_ave != "NA") %>% 
  group_by(metric) %>% 
  summarize(n_depth = n())

nvals_datadata_dist <- datadata %>% 
  filter(distance_to_shore != "NA") %>% 
  group_by(metric) %>% 
  summarize(n_dist = n()) %>% 
  rename(metric_dist = metric) #renaming because r was getting confused by 2 columns with same name in cbind()

nvals_datadata <- as_tibble(cbind(nvals_datadata_depth, nvals_datadata_dist)) %>% 
  select("metric", "n_depth", "n_dist")
              
```


Determining the n values of distance from shore and average depth for each ocean activity in alltogether

summary_alltogether has the median values
nvals_alltogether has the n values
```{r}
summary_alltogether <- alltogether %>% 
  group_by(buddy) %>% 
  summarize(median_depth = median(depth_ave, na.rm = TRUE),
            median_dist = median(distance_to_shore, na.rm = TRUE),
            max_depth = max(depth_max, na.rm = TRUE),
            min_depth = min(depth_min, na.rm = TRUE),
            max_dist = max(distance_to_shore, na.rm = TRUE),
            min_dist = min(distance_to_shore, na.rm = TRUE))
```

